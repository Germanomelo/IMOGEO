<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core">
    <h:head>
        <title>IMOGEO</title>
        <link rel="stylesheet" type="text/css" href="/IMOGEO/jsfcrud.jsf" />
        <link href="css/estilo.css" type="text/css" rel="stylesheet"/>
        <script type="text/javascript" src="http://maps.google.com/maps/api/js?key=AIzaSyDp7RiKkRTRQhkJNXz6i9vht4S-9eOcuGc"></script>
        <script type="text/javascript" src="js/maps_minha_localizacao.js"></script>
        <script type="text/javascript" src="js/maps_detalhes_imovel_marker.js"></script>
        <script type="text/javascript" src="js/maps_busca_localizacao_endereco.js"></script>
    </h:head>
    <h:body>
        <div id="topo">
            <div id ="topoconteudo">
                <ui:include src="/template-topo.xhtml"/>
            </div>
        </div>
        <div id="principal" style="height: 1080px">
            <h:form id="menulateral">
                <h:commandLink action="#{indexMB.telaExibeTodosImoveis()}" value="Todos Imóveis" styleClass="link"/>
                <h:commandLink action="#{indexMB.telaExibeImovelAlugar()}" value="Alugar Imóvel" styleClass="link"/>
                <h:commandLink action="#{indexMB.telaExibeImovelComprar()}" value="Comprar Imóvel " styleClass="link"/>
                <h:commandLink action="#{indexMB.telaExibeImovelTemporada()}" value="Temporada Imóvel " styleClass="link"/>
                <h:commandLink action="#{indexMB.telaExibeCasas()}" value="Casas" styleClass="link"/>
                <h:commandLink action="#{indexMB.telaExibeAptos()}" value="Apartamentos" styleClass="link"/>
                <h:commandLink action="#{indexMB.telaPesquisaLocalizacao()}" value="Busca por localização" styleClass="link"/>
            </h:form>

            <h:form style=" float: right;  margin-right: -100px; margin-top: 43px;" rendered="#{(indexMB.userSession !=null) &amp;&amp; (indexMB.exibeDetalhesApto || indexMB.exibeDetalhesCasa)}">
                <p:commandButton style="float: left;" rendered="#{!indexMB.favoritoExiste}" ajax="false" alt="Adicionar a favoritos" icon="ui-icon-plusthick" action="#{indexMB.inserirImovelFavorito()}"  value="Favoritos"/><br/>
                <p:commandButton style="float: left;" rendered="#{indexMB.favoritoExiste}" ajax="false" alt="Remover de favoritos" icon="ui-icon-minusthick" action="#{indexMB.removerImovelFavorito()}" value="Favoritos"/><br/>
            </h:form>

            <h:form rendered="#{!indexMB.exibePesquisaLocalizacao}">
                <h3>#{indexMB.tituloH3}</h3>
            </h:form>

            <!--busca simples-->
            <p:dataTable styleClass="tabela" paginator="true" rendered="#{indexMB.exibebuscaSimples}" rows="6" value="#{indexMB.buscaSimplesPorPalavraChave()}" var="imovel">
                <p:column width="150">
                    <img width="150" height="150" src="img/semimagem.png"></img>
                </p:column>

                <p:column >
                    <h:outputLabel value="Casa" rendered="#{imovel.class.simpleName == 'Casa'}"/>
                    <h:outputLabel value="Apartamento" rendered="#{imovel.class.simpleName == 'Apartamento'}"/>
                    para #{imovel.finalidade}<br/>
                    #{imovel.endereco.bairro}, #{imovel.endereco.cidade}, #{imovel.endereco.estado}<br/>
                    Valor: <strong style="color:orange ">R$ #{imovel.mascaraValor}</strong><br/>
                    Área total m²: #{imovel.areaTotal}, Área construida m²: #{imovel.areaConstruida} <br/>

                    <h:form>
                        <p:growl id="messages" showDetail="true" />  
                        <p:commandButton ajax="false" icon="ui-icon-newwin"  action="#{indexMB.detalhesImovel()}" value="Mais Detalhes" >
                            <f:setPropertyActionListener value="#{imovel}" target="#{indexMB.imovel}"/>
                        </p:commandButton>
                    </h:form>
                </p:column>
            </p:dataTable>

            <!--todos imoveis-->
            <p:dataTable styleClass="tabela" paginator="true" rendered="#{indexMB.exibeTodosImoveis}" rows="6" value="#{indexMB.listarImoveisAnunciados()}" var="imovel">
                <p:column width="150">
                    <img width="150" height="150" src="img/semimagem.png"></img>
                </p:column>

                <p:column >
                    <h:outputLabel value="Casa" rendered="#{imovel.class.simpleName == 'Casa'}"/>
                    <h:outputLabel value="Apartamento" rendered="#{imovel.class.simpleName == 'Apartamento'}"/>
                    para #{imovel.finalidade}<br/>
                    #{imovel.endereco.bairro}, #{imovel.endereco.cidade}, #{imovel.endereco.estado}<br/>
                    Valor: <strong style="color:orange ">R$ #{imovel.mascaraValor}</strong><br/>
                    Área total m²: #{imovel.areaTotal}, Área construida m²: #{imovel.areaConstruida} <br/>

                    <h:form>
                        <p:growl id="messages" showDetail="true" />  
                        <p:commandButton ajax="false" icon="ui-icon-newwin" action="#{indexMB.detalhesImovel()}" value="Mais Detalhes" >
                            <f:setPropertyActionListener value="#{imovel}" target="#{indexMB.imovel}"/>
                        </p:commandButton>
                    </h:form>
                </p:column>
            </p:dataTable>

            <!--imoveis finalidade-->
            <p:dataTable styleClass="tabela" paginator="true" rendered="#{indexMB.exibeImovelFinalidade}" rows="6" value="#{indexMB.listarImoveisFinalidadeAnunciados()}" var="imovel">
                <p:column width="150" >
                    <img width="150" height="150" src="img/semimagem.png"></img>
                </p:column>

                <p:column >
                    <h:outputLabel value="Casa" rendered="#{imovel.class.simpleName == 'Casa'}"/>
                    <h:outputLabel value="Apartamento" rendered="#{imovel.class.simpleName == 'Apartamento'}"/>
                    para #{imovel.finalidade}<br/>
                    #{imovel.endereco.bairro}, #{imovel.endereco.cidade}, #{imovel.endereco.estado}<br/>
                    Valor: <strong style="color:orange ">R$ #{imovel.mascaraValor}</strong><br/>
                    Área total m²: #{imovel.areaTotal}, Área construida m²: #{imovel.areaConstruida} <br/>

                    <h:form>
                        <p:growl id="messages" showDetail="true" />  
                        <p:commandButton ajax="false" icon="ui-icon-newwin" action="#{indexMB.detalhesImovel()}" value="Mais Detalhes" >
                            <f:setPropertyActionListener value="#{imovel}" target="#{indexMB.imovel}"/>
                        </p:commandButton>
                    </h:form>
                </p:column>
            </p:dataTable>

            <!--casas-->
            <p:dataTable styleClass="tabela" paginator="true" rendered="#{indexMB.exibeCasas}" rows="6" value="#{indexMB.listarCasasAnunciadas()}" var="casa">
                <p:column width="150">
                    <img width="150" height="150" src="img/semimagem.png"></img>
                </p:column>

                <p:column>
                    Casa para #{casa.finalidade}<br/>
                    #{casa.endereco.bairro}, #{casa.endereco.cidade}, #{casa.endereco.estado}<br/>
                    Valor: <strong style="color:orange ">R$ #{casa.mascaraValor}</strong><br/>
                    Área total m²: #{casa.areaTotal}, Área construida m²: #{casa.areaConstruida} <br/>
                    <h:form>
                        <p:growl id="messages" showDetail="true" />  
                        <p:commandButton ajax="false" icon="ui-icon-newwin" action="#{indexMB.detalhesCasa()}" value="Mais Detalhes" >
                            <f:setPropertyActionListener value="#{casa}" target="#{indexMB.imovel}"/>
                        </p:commandButton>
                    </h:form>
                </p:column>
            </p:dataTable>

            <!--aptos-->
            <p:dataTable styleClass="tabela" paginator="true" rendered="#{indexMB.exibeAptos}" rows="6" value="#{indexMB.listarApartamentosAnunciados()}" var="apto">
                <p:column width="150">
                    <img width="150" height="150" src="img/semimagem.png"></img>
                </p:column>

                <p:column >
                    Apartamento para #{apto.finalidade}<br/>
                    #{apto.endereco.bairro}, #{apto.endereco.cidade}, #{apto.endereco.estado}<br/>
                    Valor: <strong style="color:orange ">R$#{apto.mascaraValor}</strong><br/>
                    Área total m²: #{apto.areaTotal}, Área construida m²: #{apto.areaConstruida} <br/>

                    <h:form>
                        <p:growl id="messages" showDetail="true" />  
                        <p:commandButton ajax="false" icon="ui-icon-newwin" action="#{indexMB.detalhesApto()}" value="Mais Detalhes" >
                            <f:setPropertyActionListener value="#{apto}" target="#{indexMB.imovel}"/>
                        </p:commandButton>
                    </h:form>
                </p:column>
            </p:dataTable>

            <!--Detalhes casa-->
            <h:form id="formdetalhescasa" rendered="#{indexMB.exibeDetalhesCasa}">
                <ui:include src="/template-detalhes-casa.xhtml"/>
            </h:form>

            <!--Detalhes apto-->
            <h:form id="formdetalhesapto" rendered="#{indexMB.exibeDetalhesApto}">
                <ui:include src="/template-detalhes-apto.xhtml"/>
            </h:form>

            <!--Informações Localização-->
            <p:panel header="Localização" rendered="#{indexMB.exibeDetalhesApto || indexMB.exibeDetalhesCasa}" style="float:right; width: 745px;">
                <h:form prependId="false">
                    <h:inputText disabled="true" id="lat" value="#{indexMB.lat}"/>
                    <h:inputText disabled="true" id="log" value="#{indexMB.log}"/>
                </h:form>
                <div id="map-canvas-loc" style="width: 710px; height: 270px"></div>
            </p:panel>

            <!--Busca Localização-->
            <p:panel rendered="#{indexMB.exibePesquisaLocalizacao}" header="2. Busca de imóvel por localização" style="float:right; width: 365px;">
                <h:form prependId="false">
                    <h:panelGrid columns="2">
                        <h:outputLabel value="Raio (Km):"/>
                        <p:inputText value="#{indexMB.distancia}" maxlength="3" required="true" requiredMessage="Campo Obrigatorio!"/>

                        <p:outputLabel value="Finalidade :" for="finalidade" rendered="#{indexMB.exibeBuscaLocalizacaoAvancada}" />
                        <p:selectOneMenu id="finalidade" value="#{indexMB.pesqFinalidade}" rendered="#{indexMB.exibeBuscaLocalizacaoAvancada}">
                            <f:selectItem itemValue="TODOS" itemLabel="TODOS" />
                            <f:selectItem itemValue="ALUGAR" itemLabel="ALUGAR" />
                            <f:selectItem itemValue="VENDER" itemLabel="COMPRAR" />
                            <f:selectItem itemValue="TEMPORADA" itemLabel="TEMPORADA" />
                        </p:selectOneMenu>

                        <p:outputLabel value="Tipo:" for="tipo" rendered="#{indexMB.exibeBuscaLocalizacaoAvancada}" />
                        <p:selectOneMenu id="tipo" value="#{indexMB.pesqTipo}" rendered="#{indexMB.exibeBuscaLocalizacaoAvancada}">
                            <f:selectItem itemValue="TODOS" itemLabel="TODOS" />
                            <f:selectItem itemValue="CASA" itemLabel="CASA" />
                            <f:selectItem itemValue="APTO" itemLabel="APTO" />
                        </p:selectOneMenu>

                        <h:outputLabel value="Valor de R$:" rendered="#{indexMB.exibeBuscaLocalizacaoAvancada}"/>
                        <p:inputText value="#{indexMB.pesqValorDe}" rendered="#{indexMB.exibeBuscaLocalizacaoAvancada}" type="number" maxlength="9"/>

                        <h:outputLabel value="Valor até R$:" rendered="#{indexMB.exibeBuscaLocalizacaoAvancada}"/>
                        <p:inputText value="#{indexMB.pesqValorAte}" rendered="#{indexMB.exibeBuscaLocalizacaoAvancada}" type="number" maxlength="9"/>

                        <h:outputLabel value="Quartos:" rendered="#{indexMB.exibeBuscaLocalizacaoAvancada}"/>
                        <p:inputText value="#{indexMB.pesqQtdeQuarto}" rendered="#{indexMB.exibeBuscaLocalizacaoAvancada}"  maxlength="2"/>

                        <h:outputLabel value="Suites:" rendered="#{indexMB.exibeBuscaLocalizacaoAvancada}"/>
                        <p:inputText value="#{indexMB.pesqQtdeSuite}" rendered="#{indexMB.exibeBuscaLocalizacaoAvancada}" type="number" maxlength="2"/>

                        <h:outputLabel value="Área de m²:" rendered="#{indexMB.exibeBuscaLocalizacaoAvancada}"/>
                        <p:inputText value="#{indexMB.pesqAreaDe}" rendered="#{indexMB.exibeBuscaLocalizacaoAvancada}" type="number" maxlength="9"/>

                        <h:outputLabel value="Área até m²:" rendered="#{indexMB.exibeBuscaLocalizacaoAvancada}"/>
                        <p:inputText value="#{indexMB.pesqAreaAte}" rendered="#{indexMB.exibeBuscaLocalizacaoAvancada}" type="number" maxlength="9"/>

                        <h:outputLabel value="Vagas Garagem :" rendered="#{indexMB.exibeBuscaLocalizacaoAvancada}"/>
                        <p:inputText value="#{indexMB.pesqQtdeVagaGaragem}" rendered="#{indexMB.exibeBuscaLocalizacaoAvancada}" type="number" maxlength="2"/>

                        <h:outputLabel value="Ponto ref:"/>
                        <p:inputText id="loc" value="#{indexMB.loc}" required="true" requiredMessage="Campo Obrigatorio buscar localização"/>

                        <p:commandButton ajax="false" icon="ui-icon-search" value="Buscar" action="#{indexMB.telaResultadoPesquisaLocalizacao()}"/>
                        <p:commandButton ajax="false" icon="ui-icon-newwin" rendered="#{!indexMB.exibeBuscaLocalizacaoAvancada}" value="Busca avançada" action="#{indexMB.telaBuscaLocalizacaoAvancada()}"/>
                        <p:commandButton ajax="false" icon="ui-icon-newwin" rendered="#{indexMB.exibeBuscaLocalizacaoAvancada}" value="Busca simples" action="#{indexMB.telaBuscaLocalizacaoSimples()}"/>       

                        <h:message id="mloc" for="loc"/>
                    </h:panelGrid>
                </h:form>
            </p:panel>
            <p:panel rendered="#{indexMB.exibePesquisaLocalizacao}" header="1. Ponto referencial da busca" style="float:right; width: 365px;">
                <h:form>
                    <p:commandButton ajax="false" icon="ui-icon-pin-s" value="Obter minha localização" onclick="getLocationPeople()"/>
                </h:form>
                <h:form id="form" prependId="false" >
                    <h:panelGrid columns="3">
                        <p:outputLabel value="Rua"/>
                        <p:inputText  id="rua" required="true" requiredMessage="Campo Obrigatorio"  />
                        <p:message id="mrua" for="rua"/>

                        <p:outputLabel value="Número"/>
                        <p:inputText  id="numero"  required="true" requiredMessage="Campo Obrigatorio"  />
                        <p:message id="mnumero" for="numero"/>

                        <p:outputLabel value="Bairro"/>
                        <p:inputText  id="bairro"  required="true" requiredMessage="Campo Obrigatorio" />
                        <p:message id="mbairro" for="bairro"/>

                        <p:outputLabel value="Cidade"/>
                        <p:inputText  id="cidade"  required="true" requiredMessage="Campo Obrigatorio"/>
                        <p:message id="mcidade" for="cidade"/>

                        <p:outputLabel value="Estado"/>
                        <p:inputText  id="estado"  required="true" requiredMessage="Campo Obrigatorio" />
                        <p:message id="mestado" for="estado"/>

                        <p:commandButton icon="ui-icon-pin-s" value="Buscar Endereço" onclick="codeAddress()"/>
                    </h:panelGrid>
                </h:form>
            </p:panel>

            <p:panel header="Local do ponto de busca (localização atual)" rendered="#{(indexMB.exibeMapMinhaLocalizacao &amp;&amp; indexMB.exibePesquisaLocalizacao)}" style="float:right; width: 737px;">
                <div id="mapa_busca_minha_loc" style="width: 700px; height: 400px;"></div>
            </p:panel>
            <p:panel header="Local do ponto de busca (localização de endereço)" rendered="#{(!indexMB.exibeMapMinhaLocalizacao &amp;&amp; indexMB.exibePesquisaLocalizacao)}" style="float:right; width: 737px;">
                <div id="map_canvas" style="width: 700px; height: 400px;"/>
            </p:panel>


            <!--Todos imoveis por localizacao-->
            <p:dataTable id="vaitataruguinha" rendered="#{indexMB.exibeResultadoPesquisaLocalizacao}" paginator="true" rows="6" styleClass="tabela" value="#{indexMB.enderecoPorLocalizacao()}" var="endereco">
                <p:column width="150">
                    <img width="150" height="150" src="img/semimagem.png"></img>
                </p:column>

                <p:column>
                    <h:outputLabel value="Casa" rendered="#{endereco.imovel.class.simpleName == 'Casa'}"/>
                    <h:outputLabel value="Apartamento" rendered="#{endereco.imovel.class.simpleName == 'Apartamento'}"/>
                    para #{endereco.imovel.finalidade}<br/>
                    #{endereco.bairro}, #{endereco.cidade}, #{endereco.estado}<br/>
                    Valor: <strong style="color: orange">R$#{endereco.imovel.mascaraValor}</strong><br/>
                    Área total m²: #{endereco.imovel.areaTotal}<br/> 
                    Área construida m²: #{endereco.imovel.areaConstruida} <br/>
                    Distância:
                    <h:outputText style="color: orange; font-weight: bold;" value="#{indexMB.geometriaLocalUser(endereco.localizacao)}" >
                        <f:convertNumber minFractionDigits="0" />
                    </h:outputText>
                    <h:outputLabel style="color: orange; font-weight: bold;" value="Km" rendered="#{indexMB.exibeMedidaDeDistanciaKm}"/>
                    <h:outputLabel style="color: orange; font-weight: bold;" value="Metros" rendered="#{!indexMB.exibeMedidaDeDistanciaKm}"/>

                    <h:form>
                        <p:commandButton ajax="false" icon="ui-icon-newwin" action="#{indexMB.detalhesImovel()}" value="Mais Detalhes" >
                            <f:setPropertyActionListener value="#{endereco.imovel}" target="#{indexMB.imovel}"/>
                        </p:commandButton>
                    </h:form>
                </p:column>
            </p:dataTable>          

            <!--Comentários-->
            <p:panel style="float:right; width: 745px;" header="Comentários" rendered="#{indexMB.exibeDetalhesApto || indexMB.exibeDetalhesCasa}">
                <p:scrollPanel style="width:725px;height:185px">
                <h:form rendered="#{indexMB.userSession !=null}">
                    <h:panelGrid columns="3">
                    <p:outputLabel value="Comentário:" for="comentario" />
                    <p:inputTextarea id="comentario" value="#{indexMB.comentarioTxt}" maxlength="200" rows="2" cols="50"/>
                    <p:commandButton ajax="false" value="Enviar" action="#{indexMB.inserirComentario()}" />
                    </h:panelGrid>
                </h:form>
                
                    <p:dataTable styleClass="tabela" style="width: 710px" value="#{indexMB.listarComentarios()}" var="comentario">
                        <p:column style="width: 90px">
                        #{comentario.usuario.nome} <br/>
                        #{comentario.dataComentario}
                    </p:column>
                    <p:column>
                        #{comentario.comentario} 
                        <h:form style="float: right;" rendered="#{indexMB.userSession.id == comentario.usuario.id}">
                        <p:growl id="messages" showDetail="true" />  
                        <p:commandButton ajax="false" icon="ui-icon-trash"  action="#{indexMB.removerComentario()}" value="excluir" >
                            <f:setPropertyActionListener value="#{comentario}" target="#{indexMB.comentario}"/>
                        </p:commandButton>
                    </h:form>
                    </p:column>
                </p:dataTable>
                </p:scrollPanel>
            </p:panel>

        </div><!--fim principal-->    

        <div id="rodape">
            <ui:include src="/template-rodape.xhtml"/>
        </div>
    </h:body>

</html>

